<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kuffert">
    <link rel="apple-touch-icon" href="briefcase.png"> <title>Cozy Kuffert</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        /* --- Tema og Basis Styling --- */
        body { font-family: 'Inter', sans-serif; background-color: #fff0f5; }
        .main-container { background-color: #ffffff; border: 1px solid #fbcfe8; box-shadow: 0 4px 15px rgba(219, 112, 147, 0.1); }
        .main-title { color: #be185d; text-shadow: 1px 1px 2px rgba(219, 112, 147, 0.1); }
        .add-item-section { background-color: #fdf2f8; border-color: #fbcfe8; }
        .add-item-title { color: #9d174d; }
        label { color: #831843; font-weight: 500; }
        input[type="text"], input[type="file"], datalist { border-color: #f9a8d4; background-color: #ffffff; }
        input[type="text"]:focus { border-color: #ec4899; box-shadow: 0 0 0 2px rgba(236, 72, 153, 0.2); outline: none; }
        input[type="file"]::file-selector-button { background-color: #fce7f3; color: #be185d; border: none; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s ease; }
        input[type="file"]::file-selector-button:hover { background-color: #fbcfe8; }
        #addItemBtn { background-image: linear-gradient(to right, #f9a8d4 0%, #f472b6 50%, #ec4899 100%); color: white; border: none; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(219, 112, 147, 0.2); }
        #addItemBtn:hover { background-image: linear-gradient(to right, #f472b6 0%, #ec4899 50%, #db2777 100%); box-shadow: 0 4px 8px rgba(219, 112, 147, 0.3); transform: translateY(-1px); }
        #addCategoryBtn { background-color: #fce7f3; border-color: #f9a8d4; }
        #addCategoryBtn:hover { background-color: #fbcfe8; }
        #addCategoryBtn svg { color: #be185d; }
        #suitcaseContent h2 { color: #9d174d; border-bottom-color: #fbcfe8; }
        #emptyMessage { color: #fda4af; }

        /* Kategori Styling */
        .category-node { border-color: #fce7f3; box-shadow: 0 1px 3px rgba(219, 112, 147, 0.05); margin-bottom: 0.75rem; }
        .category-header { background-image: linear-gradient(to bottom, #ffffff, #fdf2f8); border-bottom-color: #fce7f3; cursor: pointer; user-select: none; transition: background-color 0.2s ease; }
        .category-header:hover { background-image: linear-gradient(to bottom, #fdf2f8, #fce7f3); }
        .category-header h3 { color: #be185d; }
        .category-header .toggle-icon { color: #f472b6; transition: transform 0.3s ease; }
        .delete-category-btn { color: #f9a8d4; background-color: transparent; transition: all 0.2s ease; }
        .delete-category-btn:hover { color: #be185d; background-color: #fce7f3; transform: scale(1.1); }
        .category-content { background-color: #fffafa; }
        .subcategory-container { margin-left: 1rem; padding-left: 1rem; border-left: 2px solid #fce7f3; margin-top: 0.5rem; }
        .subcategory-container .subcategory-container { margin-left: 0.75rem; padding-left: 0.75rem; }

        /* Item Styling */
        .item-div { border-color: #fce7f3; background-color: #ffffff; }
        .item-name { color: #831843; font-weight: 500; }
        .item-image-placeholder { background-color: #fdf2f8; color: #f9a8d4; }
        .item-image { border: 1px solid #fce7f3; }
        .delete-btn { color: #f472b6; background-color: transparent; transition: all 0.2s ease; }
        .delete-btn:hover { background-color: #fce7f3; color: #be185d; transform: scale(1.1); }

        /* Diverse */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .item-added { animation: fadeIn 0.3s ease-out; }
        .category-content.hidden { display: none; }
        .category-node > .category-content.hidden + .category-header .toggle-icon { transform: rotate(-90deg); }
        input, select, button { border-radius: 0.375rem; }
        datalist { display: none; }

        /* Custom Modal Styling */
        .modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 50; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-box { background-color: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); max-width: 90%; width: 400px; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.active .modal-box { transform: scale(1); }
        .modal-title { font-size: 1.25rem; font-weight: 600; color: #be185d; margin-bottom: 1rem; }
        .modal-message { margin-bottom: 1.5rem; color: #4b5563; }
        .modal-buttons { display: flex; justify-content: flex-end; gap: 0.75rem; }
        .modal-button { padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 500; transition: background-color 0.2s ease, box-shadow 0.2s ease; cursor: pointer; border: 1px solid transparent; }
        .modal-button-confirm { background-image: linear-gradient(to right, #f9a8d4, #f472b6); color: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .modal-button-confirm:hover { background-image: linear-gradient(to right, #f472b6, #ec4899); box-shadow: 0 2px 5px rgba(0,0,0,0.15); }
        .modal-button-cancel { background-color: #f3f4f6; color: #4b5563; border-color: #d1d5db; }
        .modal-button-cancel:hover { background-color: #e5e7eb; }
        .modal-button-ok { background-image: linear-gradient(to right, #a5b4fc, #818cf8); color: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .modal-button-ok:hover { background-image: linear-gradient(to right, #818cf8, #6366f1); box-shadow: 0 2px 5px rgba(0,0,0,0.15); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="main-container max-w-4xl mx-auto p-6 rounded-lg">
        <h1 class="main-title text-3xl font-bold mb-6 text-center">Cozy Kuffert</h1>
        <div class="add-item-section mb-8 p-4 border rounded-lg">
            <h2 class="add-item-title text-xl font-semibold mb-4">Tilføj en ting</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div><label for="itemName" class="block text-sm mb-1">Navn på ting:</label><input type="text" id="itemName" placeholder="F.eks. Blå Jeans" class="w-full p-2 border rounded-md focus:ring-2 focus:border-transparent"></div>
                <div><label for="itemCategory" class="block text-sm mb-1">Kategori (f.eks. Tøj > Bukser):</label><div class="flex"><input type="text" id="itemCategory" list="categorySuggestions" placeholder="Hovedkategori > Underkategori" class="flex-grow p-2 border rounded-l-md focus:ring-2 focus:border-transparent"><datalist id="categorySuggestions"></datalist><button id="addCategoryBtn" title="Tilføj kategori/sti til forslagsliste" class="p-2 border border-l-0 rounded-r-md"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /> </svg></button></div></div>
                <div><label for="itemImage" class="block text-sm mb-1">Billede:</label><input type="file" id="itemImage" accept="image/*" class="w-full text-sm"></div>
            </div>
            <button id="addItemBtn" class="mt-4 w-full md:w-auto font-semibold py-2 px-6 rounded-md flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /> </svg>Tilføj til kuffert</button>
            <p id="errorMessage" class="text-red-500 text-sm mt-2 hidden"></p>
        </div>
        <div id="suitcaseContent" class="space-y-1"><h2 class="text-2xl font-semibold mb-4 border-b pb-2">Kuffertens Indhold</h2><p id="emptyMessage" class="italic">Kufferten er tom. Tilføj ting ovenfor.</p><div id="categoryTreeContainer"></div></div>
    </div>

    <div id="confirmationModal" class="modal-overlay"><div class="modal-box"><h3 id="confirmationModalTitle" class="modal-title">Bekræft Handling</h3><p id="confirmationModalMessage" class="modal-message">Er du sikker?</p><div class="modal-buttons"><button id="confirmCancelBtn" class="modal-button modal-button-cancel">Nej, Annuller</button><button id="confirmOkBtn" class="modal-button modal-button-confirm">Ja, Fortsæt</button></div></div></div>
    <div id="alertModal" class="modal-overlay"><div class="modal-box"><h3 id="alertModalTitle" class="modal-title">Besked</h3><p id="alertModalMessage" class="modal-message">Dette er en besked.</p><div class="modal-buttons"><button id="alertOkBtn" class="modal-button modal-button-ok">OK</button></div></div></div>

    <script>
        // === DOM Elementer ===
        const itemNameInput = document.getElementById('itemName');
        const itemCategoryInput = document.getElementById('itemCategory');
        const itemImageInput = document.getElementById('itemImage');
        const addItemBtn = document.getElementById('addItemBtn');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const suitcaseContent = document.getElementById('suitcaseContent');
        const categoryTreeContainer = document.getElementById('categoryTreeContainer');
        const categorySuggestions = document.getElementById('categorySuggestions');
        const errorMessage = document.getElementById('errorMessage');
        const emptyMessage = document.getElementById('emptyMessage');
        const confirmationModal = document.getElementById('confirmationModal');
        const confirmationModalTitle = document.getElementById('confirmationModalTitle');
        const confirmationModalMessage = document.getElementById('confirmationModalMessage');
        const confirmCancelBtn = document.getElementById('confirmCancelBtn');
        const confirmOkBtn = document.getElementById('confirmOkBtn');
        const alertModal = document.getElementById('alertModal');
        const alertModalTitle = document.getElementById('alertModalTitle');
        const alertModalMessage = document.getElementById('alertModalMessage');
        const alertOkBtn = document.getElementById('alertOkBtn');

        const CATEGORY_SEPARATOR = '>';

        // === Hjælpefunktioner === (uændrede)
        function showError(message) { errorMessage.textContent = message; errorMessage.classList.remove('hidden'); }
        function hideError() { errorMessage.classList.add('hidden'); errorMessage.textContent = ''; }
        function getPackedItems() { const i=localStorage.getItem('packedItemsTree'); try{const p=JSON.parse(i); return typeof p==='object'&&p!==null?p:{};}catch(e){console.error(e);return{};} }
        function savePackedItems(items) { try{localStorage.setItem('packedItemsTree',JSON.stringify(items));}catch(e){console.error(e);showError("Kunne ikke gemme.");} }
        function parseCategoryPath(s){ return s.split(CATEGORY_SEPARATOR).map(p=>p.trim()).filter(p=>p.length>0); }
        function getOrCreateCategoryNode(t,a){ let n=t;a.forEach((p,i)=>{if(i===0){if(!n[p]){n[p]={items:[],subcategories:{}};}}else{if(!n.subcategories){n.subcategories={};}if(!n.subcategories[p]){n.subcategories[p]={items:[],subcategories:{}};}}n=(i===0)?n[p]:n.subcategories[p];});if(!n.items){n.items=[];}return n;}
        function findNodeAndParent(t,a){ let p=null,n=t,k=null;for(let i=0;i<a.length;i++){k=a[i];p=n;if(i===0){n=n[k];}else{if(!p||!p.subcategories)return{parent:null,node:null,key:null};n=p.subcategories[k];}if(!n)return{parent:null,node:null,key:null};}if(a.length===1){p=t;}return{parent:p,node:n,key:k};}
        function removeCollapseStatesRecursive(t,a){ const k=`category_${a.join('_')}_collapsed`;localStorage.removeItem(k);const{node:n}=findNodeAndParent(t,a);if(n&&n.subcategories){Object.keys(n.subcategories).forEach(sK=>{removeCollapseStatesRecursive(t,[...a,sK]);});}}
        function updateCategorySuggestions(){ const t=getPackedItems();const s=new Set();function cP(n,cP){const C=n.subcategories||n;const N=Object.keys(C);N.forEach(cN=>{if(cN==='items'||cN==='subcategories')return;const cN=C[cN];const nP=cP?[...cP,cN]:[cN];s.add(nP.join(` ${CATEGORY_SEPARATOR} `));if(cN.subcategories){cP(cN,nP);}});}cP(t,null);categorySuggestions.innerHTML='';s.forEach(sug=>{const o=document.createElement('option');o.value=sug;categorySuggestions.appendChild(o);});}

        // === Modal Funktioner === (uændrede)
        let confirmCallback = null; let cancelCallback = null;
        function showConfirmationModal(m, onC, onA=null){ confirmationModalMessage.textContent=m;confirmCallback=onC;cancelCallback=onA;confirmationModal.classList.add('active'); }
        function hideConfirmationModal(){ confirmationModal.classList.remove('active');confirmCallback=null;cancelCallback=null; }
        confirmOkBtn.addEventListener('click',()=>{if(typeof confirmCallback==='function'){confirmCallback();}hideConfirmationModal();});
        confirmCancelBtn.addEventListener('click',()=>{if(typeof cancelCallback==='function'){cancelCallback();}hideConfirmationModal();});
        confirmationModal.addEventListener('click',(e)=>{if(e.target===confirmationModal){hideConfirmationModal();if(typeof cancelCallback==='function')cancelCallback();}});
        function showAlertModal(m,t="Besked"){ alertModalTitle.textContent=t;alertModalMessage.textContent=m;alertModal.classList.add('active'); }
        function hideAlertModal(){ alertModal.classList.remove('active'); }
        alertOkBtn.addEventListener('click', hideAlertModal);
        alertModal.addEventListener('click',(e)=>{if(e.target===alertModal)hideAlertModal();});

        // === Kernefunktionalitet: Visning === (uændret)
        function displayItems() { const t=getPackedItems();categoryTreeContainer.innerHTML='';const c=Object.keys(t).sort();if(c.length===0){emptyMessage.classList.remove('hidden');return;}else{emptyMessage.classList.add('hidden');}c.forEach(cN=>{if(typeof t[cN]==='object'&&t[cN]!==null){renderCategoryNode(t[cN],cN,categoryTreeContainer,[cN]);}}); }
        function renderCategoryNode(nD,nN,pE,cP){ if(!nD)return;const cD=document.createElement('div');cD.className='category-node border rounded-lg overflow-hidden mb-3';const cH=document.createElement('div');cH.className='category-header p-3 flex justify-between items-center border-b';const dCB=document.createElement('button');dCB.className='delete-category-btn p-1 rounded-full mr-2';dCB.title=`Slet hele kategorien '${nN}' og alt indhold`;dCB.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>`;const cPTD=[...cP];dCB.onclick=(e)=>{e.stopPropagation();const cPS=cPTD.join(` ${CATEGORY_SEPARATOR} `);showConfirmationModal(`Er du sikker på, du vil slette hele kategorien "${cPS}" og alt dens indhold? Dette kan ikke fortrydes.`,()=>{const cIT=getPackedItems();const{parent:pN,node:nTD,key:nK}=findNodeAndParent(cIT,cPTD);if(!nTD){showError(`Kunne ikke finde kategori "${cPS}" til sletning.`);return;}if(pN===cIT){delete pN[nK];}else if(pN&&pN.subcategories){delete pN.subcategories[nK];}else{showError(`Kunne ikke finde forælder til kategori "${cPS}" under sletning.`);return;}removeCollapseStatesRecursive(cIT,cPTD);savePackedItems(cIT);displayItems();updateCategorySuggestions();});};const hC=document.createElement('div');hC.className="flex items-center flex-grow min-w-0";hC.appendChild(dCB);const tE=document.createElement('h3');tE.className="text-lg font-semibold truncate";tE.textContent=nN;hC.appendChild(tE);const tIC=document.createElement('div');tIC.className="flex-shrink-0 ml-2";tIC.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 toggle-icon"> <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /> </svg>`;cH.appendChild(hC);cH.appendChild(tIC);const cCo=document.createElement('div');cCo.className='category-content p-4 space-y-3';const cSK=`category_${cP.join('_')}_collapsed`;const iC=localStorage.getItem(cSK)==='true';if(iC){cCo.classList.add('hidden');tIC.querySelector('.toggle-icon').style.transform='rotate(-90deg)';}else{tIC.querySelector('.toggle-icon').style.transform='rotate(0deg)';}cH.addEventListener('click',(e)=>{if(e.target.closest('.delete-category-btn'))return;const cHi=cCo.classList.toggle('hidden');localStorage.setItem(cSK,cHi);tIC.querySelector('.toggle-icon').style.transform=cHi?'rotate(-90deg)':'rotate(0deg)';});cD.appendChild(cH);cD.appendChild(cCo);if(nD.items&&nD.items.length>0){nD.items.forEach(item=>{const iD=document.createElement('div');iD.className='item-div item-added flex items-center justify-between p-2 rounded-md border';const iI=document.createElement('div');iI.className='flex items-center space-x-3 flex-grow min-w-0';if(item.image){const img=document.createElement('img');img.src=item.image;img.alt=item.name;img.className='item-image flex-shrink-0 w-[80px] h-[80px] object-cover rounded-md';iI.appendChild(img);}else{const p=document.createElement('div');p.className='item-image-placeholder item-image flex-shrink-0 w-[80px] h-[80px] flex items-center justify-center rounded-md';p.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" /></svg>`;iI.appendChild(p);}const iNE=document.createElement('span');iNE.textContent=item.name;iNE.className='item-name truncate';iI.appendChild(iNE);iD.appendChild(iI);const dB=document.createElement('button');dB.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>`;dB.title=`Slet ${item.name}`;dB.className='delete-btn p-2 rounded-full flex-shrink-0 ml-2';const iTD=item.id;const iP=[...cP];dB.onclick=()=>{showConfirmationModal(`Er du sikker på, du vil slette "${item.name}" fra kategorien "${iP.join(` ${CATEGORY_SEPARATOR} `)}"?`,()=>{const cIT=getPackedItems();const{parent:cPN,node:cN,key:cK}=findNodeAndParent(cIT,iP);if(!cN){showError("Fejl under sletning (kategori ikke fundet).");return;}if(cN.items){const iI=cN.items.findIndex(i=>i.id===iTD);if(iI>-1){cN.items.splice(iI,1);const sK=cN.subcategories?Object.keys(cN.subcategories):[];if(cN.items.length===0&&sK.length===0&&cPN&&cK){if(cPN===cIT){delete cPN[cK];}else if(cPN.subcategories){delete cPN.subcategories[cK];}localStorage.removeItem(`category_${iP.join('_')}_collapsed`);}savePackedItems(cIT);displayItems();updateCategorySuggestions();}else{showError("Fejl under sletning (item ikke fundet i listen).");}}else{showError("Fejl under sletning (kategori har ingen items-liste).");}});};iD.appendChild(dB);cCo.appendChild(iD);});}if(nD.subcategories&&Object.keys(nD.subcategories).length>0){const sC=document.createElement('div');sC.className='subcategory-container mt-4 space-y-3';const sCN=Object.keys(nD.subcategories).sort();sCN.forEach(sCN=>{const nP=[...cP,sCN];renderCategoryNode(nD.subcategories[sCN],sCN,sC,nP);});cCo.appendChild(sC);}pE.appendChild(cD);}

        // === Kernefunktionalitet: Tilføjelse af Ting === (uændret)
        function addItem() { hideError();const n=itemNameInput.value.trim();const cPS=itemCategoryInput.value.trim();const iF=itemImageInput.files[0];if(!n){showError('Navn på tingen mangler.');itemNameInput.focus();return;}if(!cPS){showError('Kategori mangler.');itemCategoryInput.focus();return;}const cP=parseCategoryPath(cPS);if(cP.length===0){showError('Ugyldigt kategori format.');itemCategoryInput.focus();return;}const iT=getPackedItems();const tN=getOrCreateCategoryNode(iT,cP);const nI={id:Date.now()+Math.random(),name:n,image:null};if(iF){if(!iF.type.startsWith('image/')){showError('Vælg venligst en gyldig billedfil.');itemImageInput.value='';return;}const mS=2;if(iF.size>mS*1024*1024){showError(`Billedet er for stort (maks ${mS} MB).`);itemImageInput.value='';return;}const r=new FileReader();r.onloadend=()=>{nI.image=r.result;tN.items.push(nI);savePackedItems(iT);displayItems();updateCategorySuggestions();itemNameInput.value='';itemImageInput.value='';itemNameInput.focus();};r.onerror=()=>{console.error("FileReader error:",r.error);showError('Fejl ved indlæsning af billede.');};r.readAsDataURL(iF);}else{tN.items.push(nI);savePackedItems(iT);displayItems();updateCategorySuggestions();itemNameInput.value='';itemImageInput.value='';itemNameInput.focus();}}

        // === Kernefunktionalitet: Tilføj Kategori til Forslag === (uændret)
        function addCategoryToList() { hideError();const cPS=itemCategoryInput.value.trim();if(cPS){const cP=parseCategoryPath(cPS);if(cP.length===0){showError('Ugyldigt kategori format.');return;}const fP=cP.join(` ${CATEGORY_SEPARATOR} `);const eO=Array.from(categorySuggestions.options).map(o=>o.value);if(!eO.includes(fP)){const o=document.createElement('option');o.value=fP;categorySuggestions.appendChild(o);showAlertModal(`Stien "${fP}" er tilføjet til forslagslisten.`);itemCategoryInput.value='';}else{showAlertModal(`Stien "${fP}" findes allerede på forslagslisten.`);}}else{showError('Skriv en kategori/sti i kategorifeltet først.');itemCategoryInput.focus();}}

        // === Event Listeners ===
        addItemBtn.addEventListener('touchend', (e) => {
            console.log("addItemBtn touchend triggered");
            e.preventDefault(); // Forhindr evt. efterfølgende 'click' event
            addItem();
        });
        // Behold click som fallback (selvom preventDefault *burde* stoppe den)
        addItemBtn.addEventListener('click', (e) => {
            console.log("addItemBtn click triggered");
      
        });

        addCategoryBtn.addEventListener('click', addCategoryToList); // Denne bruger kun click, hvilket er ok
        itemNameInput.addEventListener('keypress', (e)=>{if(e.key==='Enter'){if(itemCategoryInput.value.trim()){addItem();}else{itemCategoryInput.focus();}}});
        itemCategoryInput.addEventListener('keypress', (e)=>{if(e.key==='Enter'){if(itemNameInput.value.trim()){addItem();}else{itemNameInput.focus();}}});

        // --- NYT: iOS Keyboard Workaround ---
        // Tilføj event listeners for at forsøge at tvinge fokus på inputfelter
        // når de berøres i iOS standalone mode. 'touchend' er ofte bedre end 'click' på touch.
        function forceFocusOnTouch(element) {
            element.addEventListener('touchend', (e) => {
                // Lille forsinkelse kan nogle gange hjælpe WebKit
                setTimeout(() => {
                    element.focus();
                    console.log(`Forceret fokus på ${element.id} efter touchend`);
                }, 100); // 100ms forsinkelse
            });
             // Fallback til click, hvis touchend ikke fanger det
             element.addEventListener('click', (e) => {
                setTimeout(() => {
                    element.focus();
                     console.log(`Forceret fokus på ${element.id} efter click`);
                }, 100);
             });
        }

        // === Initialisering ===
        document.addEventListener('DOMContentLoaded', () => {
            displayItems();
            updateCategorySuggestions();

            // Tilføj iOS keyboard workaround listeners efter DOM er klar
            forceFocusOnTouch(itemNameInput);
            forceFocusOnTouch(itemCategoryInput);
            console.log("iOS keyboard workaround listeners tilføjet.");
        });
    </script>

</body>
</html>
