<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cozy Kuffert</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        /* --- Tema og Basis Styling --- */
        body { font-family: 'Inter', sans-serif; background-color: #fff0f5; }
        .main-container { background-color: #ffffff; border: 1px solid #fbcfe8; box-shadow: 0 4px 15px rgba(219, 112, 147, 0.1); }
        .main-title { color: #be185d; text-shadow: 1px 1px 2px rgba(219, 112, 147, 0.1); }
        .add-item-section { background-color: #fdf2f8; border-color: #fbcfe8; }
        .add-item-title { color: #9d174d; }
        label { color: #831843; font-weight: 500; }
        input[type="text"], input[type="file"], datalist { border-color: #f9a8d4; background-color: #ffffff; }
        input[type="text"]:focus { border-color: #ec4899; box-shadow: 0 0 0 2px rgba(236, 72, 153, 0.2); outline: none; }
        input[type="file"]::file-selector-button { background-color: #fce7f3; color: #be185d; border: none; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s ease; }
        input[type="file"]::file-selector-button:hover { background-color: #fbcfe8; }
        #addItemBtn { background-image: linear-gradient(to right, #f9a8d4 0%, #f472b6 50%, #ec4899 100%); color: white; border: none; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(219, 112, 147, 0.2); }
        #addItemBtn:hover { background-image: linear-gradient(to right, #f472b6 0%, #ec4899 50%, #db2777 100%); box-shadow: 0 4px 8px rgba(219, 112, 147, 0.3); transform: translateY(-1px); }
        #addCategoryBtn { background-color: #fce7f3; border-color: #f9a8d4; }
        #addCategoryBtn:hover { background-color: #fbcfe8; }
        #addCategoryBtn svg { color: #be185d; }
        #suitcaseContent h2 { color: #9d174d; border-bottom-color: #fbcfe8; }
        #emptyMessage { color: #fda4af; }

        /* Kategori Styling */
        .category-node { border-color: #fce7f3; box-shadow: 0 1px 3px rgba(219, 112, 147, 0.05); margin-bottom: 0.75rem; }
        .category-header { background-image: linear-gradient(to bottom, #ffffff, #fdf2f8); border-bottom-color: #fce7f3; cursor: pointer; user-select: none; transition: background-color 0.2s ease; }
        .category-header:hover { background-image: linear-gradient(to bottom, #fdf2f8, #fce7f3); }
        .category-header h3 { color: #be185d; }
        .category-header .toggle-icon { color: #f472b6; transition: transform 0.3s ease; }
        .delete-category-btn { color: #f9a8d4; background-color: transparent; transition: all 0.2s ease; }
        .delete-category-btn:hover { color: #be185d; background-color: #fce7f3; transform: scale(1.1); }
        .category-content { background-color: #fffafa; }
        .subcategory-container { margin-left: 1rem; padding-left: 1rem; border-left: 2px solid #fce7f3; margin-top: 0.5rem; }
        .subcategory-container .subcategory-container { margin-left: 0.75rem; padding-left: 0.75rem; }

        /* Item Styling */
        .item-div { border-color: #fce7f3; background-color: #ffffff; }
        .item-name { color: #831843; font-weight: 500; }
        .item-image-placeholder { background-color: #fdf2f8; color: #f9a8d4; }
        .item-image { border: 1px solid #fce7f3; }
        .delete-btn { color: #f472b6; background-color: transparent; transition: all 0.2s ease; }
        .delete-btn:hover { background-color: #fce7f3; color: #be185d; transform: scale(1.1); }

        /* Diverse */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .item-added { animation: fadeIn 0.3s ease-out; }
        .category-content.hidden { display: none; }
        .category-node > .category-content.hidden + .category-header .toggle-icon { transform: rotate(-90deg); }
        input, select, button { border-radius: 0.375rem; }
        datalist { display: none; }

        /* --- Custom Modal Styling --- */
        .modal-overlay {
            position: fixed; inset: 0;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent sort baggrund */
            display: flex; align-items: center; justify-content: center;
            z-index: 50; /* Sørg for at den er øverst */
            opacity: 0; transition: opacity 0.3s ease; pointer-events: none;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-box {
            background-color: white;
            padding: 1.5rem; /* 24px */
            border-radius: 0.5rem; /* 8px */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-width: 90%; /* Responsiv bredde */
            width: 400px; /* Max bredde */
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-box { transform: scale(1); }
        .modal-title { font-size: 1.25rem; font-weight: 600; color: #be185d; margin-bottom: 1rem; }
        .modal-message { margin-bottom: 1.5rem; color: #4b5563; }
        .modal-buttons { display: flex; justify-content: flex-end; gap: 0.75rem; /* 12px */ }
        /* Knap styling (genbrugt fra addItemBtn men justeret) */
        .modal-button {
            padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 500;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer; border: 1px solid transparent;
        }
        .modal-button-confirm {
            background-image: linear-gradient(to right, #f9a8d4, #f472b6); color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .modal-button-confirm:hover { background-image: linear-gradient(to right, #f472b6, #ec4899); box-shadow: 0 2px 5px rgba(0,0,0,0.15); }
        .modal-button-cancel {
            background-color: #f3f4f6; /* Grålig */ color: #4b5563; border-color: #d1d5db;
        }
        .modal-button-cancel:hover { background-color: #e5e7eb; }
        .modal-button-ok { /* Til alert */
             background-image: linear-gradient(to right, #a5b4fc, #818cf8); color: white; /* Blålig */
             box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
         .modal-button-ok:hover { background-image: linear-gradient(to right, #818cf8, #6366f1); box-shadow: 0 2px 5px rgba(0,0,0,0.15); }

    </style>
</head>
<body class="p-4 md:p-8">

    <div class="main-container max-w-4xl mx-auto p-6 rounded-lg">
        <h1 class="main-title text-3xl font-bold mb-6 text-center">Cozy Kuffert</h1>
        <div class="add-item-section mb-8 p-4 border rounded-lg">
            <h2 class="add-item-title text-xl font-semibold mb-4">Tilføj en ting</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div><label for="itemName" class="block text-sm mb-1">Navn på ting:</label><input type="text" id="itemName" placeholder="F.eks. Blå Jeans" class="w-full p-2 border rounded-md focus:ring-2 focus:border-transparent"></div>
                <div><label for="itemCategory" class="block text-sm mb-1">Kategori (f.eks. Tøj > Bukser):</label><div class="flex"><input type="text" id="itemCategory" list="categorySuggestions" placeholder="Hovedkategori > Underkategori" class="flex-grow p-2 border rounded-l-md focus:ring-2 focus:border-transparent"><datalist id="categorySuggestions"></datalist><button id="addCategoryBtn" title="Tilføj kategori/sti til forslagsliste" class="p-2 border border-l-0 rounded-r-md"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /> </svg></button></div></div>
                <div><label for="itemImage" class="block text-sm mb-1">Billede:</label><input type="file" id="itemImage" accept="image/*" class="w-full text-sm"></div>
            </div>
            <button id="addItemBtn" class="mt-4 w-full md:w-auto font-semibold py-2 px-6 rounded-md flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /> </svg>Tilføj til kuffert</button>
            <p id="errorMessage" class="text-red-500 text-sm mt-2 hidden"></p>
        </div>
        <div id="suitcaseContent" class="space-y-1"><h2 class="text-2xl font-semibold mb-4 border-b pb-2">Kuffertens Indhold</h2><p id="emptyMessage" class="italic">Kufferten er tom. Tilføj ting ovenfor.</p><div id="categoryTreeContainer"></div></div>
    </div>

    <div id="confirmationModal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="confirmationModalTitle" class="modal-title">Bekræft Handling</h3>
            <p id="confirmationModalMessage" class="modal-message">Er du sikker?</p>
            <div class="modal-buttons">
                <button id="confirmCancelBtn" class="modal-button modal-button-cancel">Nej, Annuller</button>
                <button id="confirmOkBtn" class="modal-button modal-button-confirm">Ja, Fortsæt</button>
            </div>
        </div>
    </div>

    <div id="alertModal" class="modal-overlay">
        <div class="modal-box">
             <h3 id="alertModalTitle" class="modal-title">Besked</h3>
             <p id="alertModalMessage" class="modal-message">Dette er en besked.</p>
             <div class="modal-buttons">
                 <button id="alertOkBtn" class="modal-button modal-button-ok">OK</button>
             </div>
        </div>
    </div>
    <script>
        // === DOM Elementer ===
        const itemNameInput = document.getElementById('itemName'); /* ... osv ... */
        const itemCategoryInput = document.getElementById('itemCategory');
        const itemImageInput = document.getElementById('itemImage');
        const addItemBtn = document.getElementById('addItemBtn');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const suitcaseContent = document.getElementById('suitcaseContent');
        const categoryTreeContainer = document.getElementById('categoryTreeContainer');
        const categorySuggestions = document.getElementById('categorySuggestions');
        const errorMessage = document.getElementById('errorMessage');
        const emptyMessage = document.getElementById('emptyMessage');
        // Modal Elementer
        const confirmationModal = document.getElementById('confirmationModal');
        const confirmationModalTitle = document.getElementById('confirmationModalTitle');
        const confirmationModalMessage = document.getElementById('confirmationModalMessage');
        const confirmCancelBtn = document.getElementById('confirmCancelBtn');
        const confirmOkBtn = document.getElementById('confirmOkBtn');
        const alertModal = document.getElementById('alertModal');
        const alertModalTitle = document.getElementById('alertModalTitle');
        const alertModalMessage = document.getElementById('alertModalMessage');
        const alertOkBtn = document.getElementById('alertOkBtn');

        const CATEGORY_SEPARATOR = '>';

        // === Hjælpefunktioner ===
        function showError(message) { errorMessage.textContent = message; errorMessage.classList.remove('hidden'); }
        function hideError() { errorMessage.classList.add('hidden'); errorMessage.textContent = ''; }
        function getPackedItems() { /* ... uændret ... */
            const items = localStorage.getItem('packedItemsTree');
            try { const parsed = JSON.parse(items); return typeof parsed === 'object' && parsed !== null ? parsed : {}; }
            catch (e) { console.error("Fejl ved parsing af localStorage data:", e); return {}; }
        }
        function savePackedItems(items) { /* ... uændret ... */
            try { localStorage.setItem('packedItemsTree', JSON.stringify(items)); }
            catch (e) { console.error("Fejl ved gemning til localStorage:", e); showError("Kunne ikke gemme ændringer."); }
        }
        function parseCategoryPath(pathString) { /* ... uændret ... */
            return pathString.split(CATEGORY_SEPARATOR).map(part => part.trim()).filter(part => part.length > 0);
        }
        function getOrCreateCategoryNode(itemsTree, pathArray) { /* ... uændret ... */
            let currentNode = itemsTree;
            pathArray.forEach((part, index) => {
                if (index === 0) { if (!currentNode[part]) { currentNode[part] = { items: [], subcategories: {} }; } currentNode = currentNode[part]; }
                else { if (!currentNode.subcategories) { currentNode.subcategories = {}; } if (!currentNode.subcategories[part]) { currentNode.subcategories[part] = { items: [], subcategories: {} }; } currentNode = currentNode.subcategories[part]; }
            });
            if (!currentNode.items) { currentNode.items = []; } return currentNode;
        }
        function findNodeAndParent(itemsTree, pathArray) { /* ... uændret ... */
            let parent = null; let node = itemsTree; let currentKey = null;
            for (let i = 0; i < pathArray.length; i++) {
                currentKey = pathArray[i]; parent = node;
                if (i === 0) { node = node[currentKey]; } else { if (!parent || !parent.subcategories) return { parent: null, node: null, key: null }; node = parent.subcategories[currentKey]; }
                if (!node) return { parent: null, node: null, key: null };
            } if (pathArray.length === 1) { parent = itemsTree; } return { parent, node, key: currentKey };
        }
        function removeCollapseStatesRecursive(itemsTree, pathArray) { /* ... uændret ... */
             const key = `category_${pathArray.join('_')}_collapsed`; localStorage.removeItem(key);
             const { node } = findNodeAndParent(itemsTree, pathArray);
             if (node && node.subcategories) { Object.keys(node.subcategories).forEach(subKey => { removeCollapseStatesRecursive(itemsTree, [...pathArray, subKey]); }); }
        }
        function updateCategorySuggestions() { /* ... uændret ... */
            const itemsTree = getPackedItems(); const suggestions = new Set();
            function collectPaths(node, currentPath) { const children = node.subcategories || node; const categoryNames = Object.keys(children); categoryNames.forEach(categoryName => { if (categoryName === 'items' || categoryName === 'subcategories') return; const categoryNode = children[categoryName]; const newPath = currentPath ? [...currentPath, categoryName] : [categoryName]; suggestions.add(newPath.join(` ${CATEGORY_SEPARATOR} `)); if (categoryNode.subcategories) { collectPaths(categoryNode, newPath); } }); }
            collectPaths(itemsTree, null); categorySuggestions.innerHTML = ''; suggestions.forEach(suggestion => { const option = document.createElement('option'); option.value = suggestion; categorySuggestions.appendChild(option); });
        }

        // --- Nye Modal Funktioner ---
        let confirmCallback = null;
        let cancelCallback = null;

        function showConfirmationModal(message, onConfirm, onCancel = null) {
            confirmationModalMessage.textContent = message;
            confirmCallback = onConfirm; // Gem callback til senere brug
            cancelCallback = onCancel;
            confirmationModal.classList.add('active'); // Vis modal
        }

        function hideConfirmationModal() {
            confirmationModal.classList.remove('active'); // Skjul modal
            confirmCallback = null; // Ryd callbacks
            cancelCallback = null;
        }

        confirmOkBtn.addEventListener('click', () => {
            if (typeof confirmCallback === 'function') {
                confirmCallback(); // Udfør bekræftelses-handlingen
            }
            hideConfirmationModal();
        });

        confirmCancelBtn.addEventListener('click', () => {
            if (typeof cancelCallback === 'function') {
                cancelCallback(); // Udfør annuller-handlingen (hvis defineret)
            }
            hideConfirmationModal();
        });

        // Luk modal hvis man klikker på overlay'et bagved
        confirmationModal.addEventListener('click', (e) => {
             if (e.target === confirmationModal) {
                 hideConfirmationModal();
                 if (typeof cancelCallback === 'function') cancelCallback();
             }
        });


        function showAlertModal(message, title = "Besked") {
             alertModalTitle.textContent = title;
             alertModalMessage.textContent = message;
             alertModal.classList.add('active');
        }

        function hideAlertModal() {
            alertModal.classList.remove('active');
        }

        alertOkBtn.addEventListener('click', hideAlertModal);
        alertModal.addEventListener('click', (e) => {
             if (e.target === alertModal) hideAlertModal();
        });
        // --- Slut Nye Modal Funktioner ---


        // === Kernefunktionalitet: Visning af Ting (Rekursiv) ===
        function displayItems() { /* ... uændret visningslogik ... */
            const itemsTree = getPackedItems(); categoryTreeContainer.innerHTML = '';
            const topLevelCategories = Object.keys(itemsTree).sort();
            if (topLevelCategories.length === 0) { emptyMessage.classList.remove('hidden'); return; }
            else { emptyMessage.classList.add('hidden'); }
            topLevelCategories.forEach(categoryName => { if (typeof itemsTree[categoryName] === 'object' && itemsTree[categoryName] !== null) { renderCategoryNode(itemsTree[categoryName], categoryName, categoryTreeContainer, [categoryName]); } });
        }

        function renderCategoryNode(nodeData, nodeName, parentElement, currentPath) {
            if (!nodeData) return;
            const categoryDiv = document.createElement('div'); categoryDiv.className = 'category-node border rounded-lg overflow-hidden mb-3';
            const categoryHeader = document.createElement('div'); categoryHeader.className = 'category-header p-3 flex justify-between items-center border-b';

            // Kategori Slet Knap
            const deleteCategoryButton = document.createElement('button'); deleteCategoryButton.className = 'delete-category-btn p-1 rounded-full mr-2';
            deleteCategoryButton.title = `Slet hele kategorien '${nodeName}' og alt indhold`;
            deleteCategoryButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>`;
            const categoryPathToDelete = [...currentPath];
            deleteCategoryButton.onclick = (e) => {
                e.stopPropagation(); const categoryPathString = categoryPathToDelete.join(` ${CATEGORY_SEPARATOR} `);
                // Brug custom modal
                showConfirmationModal(
                    `Er du sikker på, du vil slette hele kategorien "${categoryPathString}" og alt dens indhold (inklusive underkategorier)? Dette kan ikke fortrydes.`,
                    () => { // onConfirm callback
                        const currentItemsTree = getPackedItems();
                        const { parent: parentNode, node: nodeToDelete, key: nodeKey } = findNodeAndParent(currentItemsTree, categoryPathToDelete);
                        if (!nodeToDelete) { showError(`Kunne ikke finde kategori "${categoryPathString}" til sletning.`); return; }
                        if (parentNode === currentItemsTree) { delete parentNode[nodeKey]; }
                        else if (parentNode && parentNode.subcategories) { delete parentNode.subcategories[nodeKey]; }
                        else { showError(`Kunne ikke finde forælder til kategori "${categoryPathString}" under sletning.`); return; }
                        removeCollapseStatesRecursive(currentItemsTree, categoryPathToDelete);
                        savePackedItems(currentItemsTree); displayItems(); updateCategorySuggestions();
                    }
                );
            };

            // Saml header indhold
            const headerContent = document.createElement('div'); headerContent.className = "flex items-center flex-grow min-w-0";
            headerContent.appendChild(deleteCategoryButton); const titleElement = document.createElement('h3'); titleElement.className = "text-lg font-semibold truncate"; titleElement.textContent = nodeName; headerContent.appendChild(titleElement);
            const toggleIconContainer = document.createElement('div'); toggleIconContainer.className = "flex-shrink-0 ml-2"; toggleIconContainer.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 toggle-icon"> <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /> </svg>`;
            categoryHeader.appendChild(headerContent); categoryHeader.appendChild(toggleIconContainer);

            const categoryContent = document.createElement('div'); categoryContent.className = 'category-content p-4 space-y-3';
            const collapseStateKey = `category_${currentPath.join('_')}_collapsed`; const isCollapsed = localStorage.getItem(collapseStateKey) === 'true';
            if (isCollapsed) { categoryContent.classList.add('hidden'); toggleIconContainer.querySelector('.toggle-icon').style.transform = 'rotate(-90deg)'; }
            else { toggleIconContainer.querySelector('.toggle-icon').style.transform = 'rotate(0deg)'; }

            categoryHeader.addEventListener('click', (e) => {
                if (e.target.closest('.delete-category-btn')) return; const currentlyHidden = categoryContent.classList.toggle('hidden');
                localStorage.setItem(collapseStateKey, currentlyHidden); toggleIconContainer.querySelector('.toggle-icon').style.transform = currentlyHidden ? 'rotate(-90deg)' : 'rotate(0deg)';
            });

            categoryDiv.appendChild(categoryHeader); categoryDiv.appendChild(categoryContent);

            // Render Items
            if (nodeData.items && nodeData.items.length > 0) {
                nodeData.items.forEach(item => {
                    const itemDiv = document.createElement('div'); itemDiv.className = 'item-div item-added flex items-center justify-between p-2 rounded-md border';
                    const itemInfo = document.createElement('div'); itemInfo.className = 'flex items-center space-x-3 flex-grow min-w-0';
                    // Billede/Placeholder
                    if (item.image) { const img = document.createElement('img'); img.src = item.image; img.alt = item.name; img.className = 'item-image flex-shrink-0 w-[80px] h-[80px] object-cover rounded-md'; itemInfo.appendChild(img); }
                    else { const placeholder = document.createElement('div'); placeholder.className = 'item-image-placeholder item-image flex-shrink-0 w-[80px] h-[80px] flex items-center justify-center rounded-md'; placeholder.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" /></svg>`; itemInfo.appendChild(placeholder); }
                    // Navn
                    const itemNameElement = document.createElement('span'); itemNameElement.textContent = item.name; itemNameElement.className = 'item-name truncate'; itemInfo.appendChild(itemNameElement);
                    itemDiv.appendChild(itemInfo);

                    // --- Item Slet Knap (Bruger nu custom modal) ---
                    const deleteButton = document.createElement('button');
                    deleteButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>`;
                    deleteButton.title = `Slet ${item.name}`; deleteButton.className = 'delete-btn p-2 rounded-full flex-shrink-0 ml-2';

                    const itemIdToDelete = item.id; const itemPath = [...currentPath];

                    deleteButton.onclick = () => {
                        // Brug custom modal
                        showConfirmationModal(
                            `Er du sikker på, du vil slette "${item.name}" fra kategorien "${itemPath.join(` ${CATEGORY_SEPARATOR} `)}"?`,
                            () => { // onConfirm callback
                                const currentItemsTree = getPackedItems();
                                const { parent: categoryParentNode, node: categoryNode, key: categoryKey } = findNodeAndParent(currentItemsTree, itemPath);

                                if (!categoryNode) { showError("Fejl under sletning (kategori ikke fundet)."); return; }

                                if (categoryNode.items) {
                                    const itemIndex = categoryNode.items.findIndex(i => i.id === itemIdToDelete);
                                    if (itemIndex > -1) {
                                        categoryNode.items.splice(itemIndex, 1); // Fjern item
                                        // Tjek om kategorien nu er tom og skal slettes
                                        const subKeys = categoryNode.subcategories ? Object.keys(categoryNode.subcategories) : [];
                                        if (categoryNode.items.length === 0 && subKeys.length === 0 && categoryParentNode && categoryKey) {
                                             if (categoryParentNode === currentItemsTree) { delete categoryParentNode[categoryKey]; }
                                             else if (categoryParentNode.subcategories) { delete categoryParentNode.subcategories[categoryKey]; }
                                             localStorage.removeItem(`category_${itemPath.join('_')}_collapsed`);
                                        }
                                        savePackedItems(currentItemsTree);
                                        displayItems();
                                        updateCategorySuggestions();
                                    } else { showError("Fejl under sletning (item ikke fundet i listen)."); }
                                } else { showError("Fejl under sletning (kategori har ingen items-liste)."); }
                            }
                            // Ingen onCancel callback nødvendig her, modalen lukker bare
                        );
                    }; // slut item slet onclick
                    itemDiv.appendChild(deleteButton);
                    categoryContent.appendChild(itemDiv);
                }); // slut forEach item
            } // slut if nodeData.items

            // Render Underkategorier
            if (nodeData.subcategories && Object.keys(nodeData.subcategories).length > 0) {
                const subcategoryContainer = document.createElement('div'); subcategoryContainer.className = 'subcategory-container mt-4 space-y-3';
                const subCategoryNames = Object.keys(nodeData.subcategories).sort();
                subCategoryNames.forEach(subCategoryName => { const newPath = [...currentPath, subCategoryName]; renderCategoryNode(nodeData.subcategories[subCategoryName], subCategoryName, subcategoryContainer, newPath); });
                categoryContent.appendChild(subcategoryContainer);
            }
            parentElement.appendChild(categoryDiv);
        }


        // === Kernefunktionalitet: Tilføjelse af Ting === (Uændret)
        function addItem() { /* ... uændret ... */
             hideError(); const name = itemNameInput.value.trim(); const categoryPathString = itemCategoryInput.value.trim(); const imageFile = itemImageInput.files[0];
             if (!name) { showError('Navn på tingen mangler.'); itemNameInput.focus(); return; } if (!categoryPathString) { showError('Kategori mangler.'); itemCategoryInput.focus(); return; } const categoryPath = parseCategoryPath(categoryPathString); if (categoryPath.length === 0) { showError('Ugyldigt kategori format.'); itemCategoryInput.focus(); return; } const itemsTree = getPackedItems(); const targetNode = getOrCreateCategoryNode(itemsTree, categoryPath); const newItem = { id: Date.now() + Math.random(), name: name, image: null };
             if (imageFile) { if (!imageFile.type.startsWith('image/')) { showError('Vælg venligst en gyldig billedfil.'); itemImageInput.value = ''; return; } const maxSizeMB = 2; if (imageFile.size > maxSizeMB * 1024 * 1024) { showError(`Billedet er for stort (maks ${maxSizeMB} MB).`); itemImageInput.value = ''; return; } const reader = new FileReader(); reader.onloadend = () => { newItem.image = reader.result; targetNode.items.push(newItem); savePackedItems(itemsTree); displayItems(); updateCategorySuggestions(); itemNameInput.value = ''; itemImageInput.value = ''; itemNameInput.focus(); }; reader.onerror = () => { console.error("FileReader error:", reader.error); showError('Fejl ved indlæsning af billede.'); }; reader.readAsDataURL(imageFile); }
             else { targetNode.items.push(newItem); savePackedItems(itemsTree); displayItems(); updateCategorySuggestions(); itemNameInput.value = ''; itemImageInput.value = ''; itemNameInput.focus(); }
        }

        // === Kernefunktionalitet: Tilføj Kategori til Forslag === (Bruger nu showAlertModal)
        function addCategoryToList() {
             hideError(); const categoryPathString = itemCategoryInput.value.trim();
             if (categoryPathString) {
                 const categoryPath = parseCategoryPath(categoryPathString);
                 if (categoryPath.length === 0) { showError('Ugyldigt kategori format.'); return; }
                 const formattedPath = categoryPath.join(` ${CATEGORY_SEPARATOR} `);
                 const existingOptions = Array.from(categorySuggestions.options).map(opt => opt.value);
                 if (!existingOptions.includes(formattedPath)) {
                     const option = document.createElement('option'); option.value = formattedPath;
                     categorySuggestions.appendChild(option);
                     // Brug custom alert
                     showAlertModal(`Stien "${formattedPath}" er tilføjet til forslagslisten.`);
                     itemCategoryInput.value = '';
                 } else {
                     // Brug custom alert
                     showAlertModal(`Stien "${formattedPath}" findes allerede på forslagslisten.`);
                 }
             } else { showError('Skriv en kategori/sti i kategorifeltet først.'); itemCategoryInput.focus(); }
        }

        // === Event Listeners === (Uændret)
        addItemBtn.addEventListener('click', addItem); addCategoryBtn.addEventListener('click', addCategoryToList);
        itemNameInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { if (itemCategoryInput.value.trim()) { addItem(); } else { itemCategoryInput.focus(); } } });
        itemCategoryInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { if (itemNameInput.value.trim()) { addItem(); } else { itemNameInput.focus(); } } });

        // === Initialisering === (Uændret)
        document.addEventListener('DOMContentLoaded', () => { displayItems(); updateCategorySuggestions(); });
    </script>

</body>
</html>
